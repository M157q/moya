38{% extends "dirlistbase.html" %}

{% block "title" %}Directory listing for ${.request.path}{% endblock %}

{% block "head" %}
<style type="text/css">

{% include "bootstrap.css" %}
{% include "dark.css" %}

.well table
{
    margin-bottom:0px;
}

.table td
{
  border-top:1px dotted #333 !important;
}

.table > thead > tr > th
{
    border-bottom:none;
}

.file-size
{
    text-align:right;
}

td.file-size
{
    white-space: nowrap;
}

td,th
{
    padding-right:1em !important;
}

</style>
{% endblock %}

{% def "show_date" -%}
{%- cache for 1d key [dt, .now.local.date] %}
{%- compact %}
{%- if dt %}
{% if dt.local.date == .now.local.date %}Today{% else %}${localize:dt.local.date}{% endif %}<span class="text-muted">, ${localize:dt.local.time}</span>
{%- endif %}
{%- end-compact %}
{%- end-cache %}
{%- end-def %}

{% block "content" %}
<div class="container">
    <h2>${.request.path_info} <small>directory index</small></h2>
    {%- if path != '/' %}
    <p>
    	<a class="btn btn-link" href="../">&crarr; parent directory</a>
    </p>
    {%- endif %}

    {% if .debug %}
    <pre>${fs[path]}</pre>
    {% endif %}

    <div class="well well-sm">
        <table class="table table-condensed">
            <thead>
            	<tr>
            		<th>Name</th>
                    <th class="file-size">Size</th>
            		<th>Created</th>
            		<th>Modified</th>
            	</tr>
            </thead>
            <tbody>
            	{%- for info in dirlist.dirs %}
            	<tr>
                    <!-- TODO: path.replace('#', '%23') -->
            		<td><strong><a href="${info.name}/" title="directory">${info.name}</a></strong></td>
                    <td class="file-size text-muted">&nbsp;</td>
                    <td>{% call "show_date" with dt=info.created %}</td>
                    <td>{% call "show_date" with dt=info.modified %}</td>
            	</tr>
            	{%- endfor %}
            	{%- for info in dirlist.files %}
            	<tr>
            		<td><a href="${info.name}" title="file">${info.name}</a></td>
                    <td class="file-size" title="(${info.size::','} bytes)">${filesize:info.size}</td>
                    <td>{% call "show_date" with dt=info.created %}</td>
                    <td>{% call "show_date" with dt=info.modified %}</td>
            	</tr>
            	{%- endfor %}
            </tbody>
        </table>
    </div>

    <div>
        <div class="pull-right"><a href="${app.lib.url}">moya.static ${app.lib.version}</a></div>
    	${len:dirlist.dirs::','} {% if len:dirlist.dirs == 1 %}directory{% else %}directories{% endif %},
        ${len:dirlist.files::','} {% if len:dirlist.files == 1 %}file{% else %}files{% endif %}
    </div>
    <br/>
</div>
{% endblock %}
