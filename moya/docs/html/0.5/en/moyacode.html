<!DOCTYPE html>
<!-- saved from url=(0065)http://twitter.github.io/bootstrap/examples/starter-template.html -->
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <title>Moya Code</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <link href="assets/css/bootstrap.css" rel="stylesheet">
        <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
        <link href="assets/css/custom.css" rel="stylesheet">

        <style>
        
        </style>
    </head>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

  <body>
    <div id="wrap">
    <div id="main-nav" class="navbar navbar-default navbar-static-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".doc-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="index.html">Moya Documentation</a>
            </div>
            <nav class="collapse navbar-collapse doc-navbar-collapse" role="navigation">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="index.html">Reference</a>
                    </li>
                    <li >
                        <a href="tags/index.html">Tags</a>
                    </li>
                    <li >
                        <a href="tutorial.html">Tutorial</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    
<div class="container">
    <div class="row">
        <div class="doc-content col-md-9">
            

<div class="doc-nav">
    <ul class="pager">
        <li class="previous">
            <a href="start.html">&larr; 4. Starting a Project</a>
        </li>
        
        <li class="next">
            <a href="expressions.html">6. Expressions &rarr;</a>
        </li>
    </ul>
</div>


            <h1>Moya Code</h1>
            <p>Moya code is executable code stored in XML documents within your project, and is responsible for all aspects of building a dynamic website; from querying the database to processing forms. An entire web site may be developed using nothing more than Moya code.</p>
<h2><a name="testing-moya-code"></a><a href="#testing-moya-code">Testing Moya Code<span class="anchor"> &#182;</span></a></h2><p>Moya code typically executes in the context of a project, but it can also be used stand-alone. This is useful for testing. If you would like to follow along with the code in this chapter you can use the following document template to run code:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag tagcontent">&nbsp;xmlns:let=</span><span class="attrib tag tagcontent">"http://moyaproject.com/let"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;World!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>To run this code save it as <code>example.xml</code>, then enter the following from the command line:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;run&nbsp;example.xml</div></pre><p>The above code should display the text <code>Hello, World!</code> to the console.</p>
<p>The first tag, <a class="tag" href="tags/httpmoyaprojectcom/tag_moya.html">&lt;moya&gt;</a>, is required for all Moya code files. This tag introduces two XML namespaces; <code>http://moyaproject.com</code> is the namespaces containing builtin tags (required for virtually all logic files). The <code>http://moyaproject.com/let</code> namespaces enables the <code>let</code> extension (explained later), which isn't strictly required, but very commonly used.</p>
<p>The second tag, <a class="tag" href="tags/httpmoyaprojectcom/tag_macro.html">&lt;macro&gt;</a>, creates a <em>macro</em> (a starting point for executable code), with the <em>docname</em> of <code>'main'</code>. In Moya a <code>docname</code> is a unique name that can be applied to identify tags in a document. The name, <code>"main"</code>, is the default macro executed with the run command. You can also execute other macros within a document with the <code>-e</code> switch.</p>
<p>The third tag, <a class="tag" href="tags/httpmoyaprojectcom/tag_echo.html">&lt;echo&gt;</a>, writes enclosed text to the console (terminal). It's this tag which prints out the text <code>Hello, World!</code>.</p>
<p>To run snippets of code from this document, replace the <code>&lt;echo&gt;</code> tag with the code you have cut and pasted.</p>
<p>You can set <em>parameters</em> to the main macro from the command line with the <code>--let</code> switch. For example, <code>--let foo=bar</code> would set a parameter called <code>foo</code> to the value <code>"bar"</code>. Let's add a few lines to the above code to use a command line parameter:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag tagcontent">&nbsp;xmlns:let=</span><span class="attrib tag tagcontent">"http://moyaproject.com/let"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>Run the above code with the following command line:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;run&nbsp;example.xml&nbsp;--let&nbsp;name="Moya&nbsp;Fan"</div></pre><p>You should see a more personalized greeting on the command line.</p>
<h3><a name="using-the-debugger"></a><a href="#using-the-debugger">Using the Debugger<span class="anchor"> &#182;</span></a></h3><p>Moya contains a built-in debugger for Moya code, which you can use to step through Moya code line by line and inspect data. You can drop in to the debugger with the <code>run</code> sub-command, by using the <code>--breakpoint</code> switch. For example:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;run&nbsp;example.xml&nbsp;--breakpoint</div></pre><p>This will open the file <code>"example.xml"</code> and drop straight in to the debugger. You should see a snippet of code to indicate where Moya is currently executing and a command prompt. If you enter an expression at this point, Moya will evaluate it and print the results. You can also enter one of a number of commands to step through the code and view information about the execution process. Type <code>help</code> in the debugger for a list of these commands.</p>
<p>An alternative way of entering the debugger is to use the <a class="tag" href="tags/httpmoyaprojectcom/tag_breakpoint.html">&lt;breakpoint&gt;</a> tag. If you run the code (without the <code>--breakpoint</code> switch), then Moya will drop in to the debugger when it reaches a <a class="tag" href="tags/httpmoyaprojectcom/tag_breakpoint.html">&lt;breakpoint&gt;</a> tag.</p>
<p>Try it with the following code:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag tagcontent">&nbsp;xmlns:let=</span><span class="attrib tag tagcontent">"http://moyaproject.com/let"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">input</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"name"</span><span class="tag">&gt;</span>What&nbsp;is&nbsp;your&nbsp;name?</span><span class="tag">&lt;</span><span class="endtagname tag">/input</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">breakpoint</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"name=='Rygel'"</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Sorry,&nbsp;we&nbsp;don't&nbsp;serve&nbsp;Hynerians&nbsp;here</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line9"></a><div class="line line-9"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>You should find that Moya drops in to the debugger immediately after you have entered text. You can see the contents of the variable <code>name</code> simply by entering it on the command line.</p>
<h3><a name="dynamic-help"></a><a href="#dynamic-help">Dynamic Help<span class="anchor"> &#182;</span></a></h3><p>The Moya command line app also includes access to a dynamically generate help system, which can display information on any tag. The same information is available online, but this may save you a little time. Here's how to look up the help for the <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> tag:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;help&nbsp;if</div></pre><p>You can also look up a tag defined in a different XML namespaces, by specifiying the namespace URL within curly braces. For example:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;help&nbsp;{http://moyaproject.com/db}query</div></pre><p>If you don't include the full namespaces URL, Moya assumes it to start with <code>http://moyaproject.com/</code>, so the following is equivalent to the above command line:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;help&nbsp;{db}query</div></pre><p>You can also access the dynamic help from the debugger via the <code>help</code> command, which works just like the command line (but without typing <code>moya</code>).</p>
<h2><a name="statements"></a><a href="#statements">Statements<span class="anchor"> &#182;</span></a></h2><p>A <em>statement</em> in Moya code consists of a single tag, which is in essence a function call. When Moya encounters a tag, it executes the associated functionality, using the tag attributes as parameters to the function call.</p>
<p>Lets look at one of the simplest such tags in Moya, the <a class="tag" href="tags/httpmoyaprojectcom/tag_echo.html">&lt;echo&gt;</a> tag, which writes any text contained within the opening and closing tag to the console:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;World!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div></pre><h2><a name="expressions"></a><a href="#expressions">Expressions<span class="anchor"> &#182;</span></a></h2><p>Moya can perform calculations on numbers, text, and other data with an expression syntax that is somewhat similar to other programming languages, such as Python, C and Javascript. All the familiar operators, such as + - * / will work as you might expect. For example <code>1 + 1</code> evaluates to <code>2</code>. There are also extensions to simple expression evaluation for data types and operations commonly used in web development. This often makes Moya expressions more concise and readable than expressions in other languages.</p>
<p>Here are some expressions taken from builting Moya libraries:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">not&nbsp;(value&nbsp;^=&nbsp;'http://'&nbsp;or&nbsp;value&nbsp;^='https://')</div><a name="line2"></a><div class="line line-2">score&nbsp;not&nbsp;in&nbsp;[-1,0,1]</div><a name="line3"></a><div class="line line-3">slug:form.data.title</div><a name="line4"></a><div class="line line-4">permission:.app.settings.new_topic_permission</div><a name="line5"></a><div class="line line-5">basename:path&nbsp;fnmatches&nbsp;wildcard</div><a name="line6"></a><div class="line line-6">path:dirname:path&nbsp;/&nbsp;thumbnail_directory&nbsp;/&nbsp;basename:path</div></pre><p>Expressions will be covered in detail in the <a href="expressions.html" title="Expressions">next chapter</a>, but lets introduce some of the basic concepts.</p>
<h3><a name="numbers"></a><a href="#numbers">Numbers<span class="anchor"> &#182;</span></a></h3><p>Moya can work with numbers, and the usual <a href="expressions.html#arithmetic-operators" title="Expressions">arithmetic</a> operators:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">5&nbsp;+&nbsp;(3&nbsp;*&nbsp;2)</div><a name="line2"></a><div class="line line-2">radius&nbsp;*&nbsp;2&nbsp;*&nbsp;3.1426</div></pre><h3><a name="strings"></a><a href="#strings">Strings<span class="anchor"> &#182;</span></a></h3><p>Strings (text) are defined between either single (<code>'</code>) or double (<code>"</code>) quotes. When given in a tag attribute, you will probably have to stick to single quotes, since double quotes have a special meaning in XML. Here are some expressions using <a href="expressions.html#strings" title="Expressions">strings</a>:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">"where&nbsp;there&nbsp;is&nbsp;a&nbsp;will"</div><a name="line2"></a><div class="line line-2">'Hello,&nbsp;'&nbsp;+&nbsp;name&nbsp;+&nbsp;'!'</div></pre><h3><a name="operators"></a><a href="#operators">Operators<span class="anchor"> &#182;</span></a></h3><p>An <a href="expressions.html#operators" title="Expressions">operator</a> combines two values. For example, the <code>==</code> operator checks for equality. Here is an example of some Moya code that uses the equality operator:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"species=='Hynerian'"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Sorry,&nbsp;we&nbsp;don't&nbsp;serve&nbsp;your&nbsp;kind&nbsp;here.</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div></pre><h3><a name="modifiers"></a><a href="#modifiers">Modifiers<span class="anchor"> &#182;</span></a></h3><p>A <em>modifier</em> takes a value and transforms it in some way. The following is an example of <a href="expressions.html#modifiers" title="Expressions">modifiers</a> in expressions:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">"Hello&nbsp;"&nbsp;+&nbsp;title:name&nbsp;+&nbsp;'!'</div></pre><p>In the above code, the <a href="expressions.html#title" title="Expressions">title:</a> modifier modifies the string in <code>name</code> so that it begins with a capital letter.</p>
<h2><a name="expression-substitution"></a><a href="#expression-substitution">Expression Substitution<span class="anchor"> &#182;</span></a></h2><p>Expressions may appear within text defined inside a tag, or an attribute that expects text, by wrapping it in <code>${</code> and <code>}</code>. For example, the following code asks the user for their name then outputs their name and a greeting to the console:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">input</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"name"</span><span class="tag">&gt;</span>What&nbsp;is&nbsp;your&nbsp;name?</span><span class="tag">&lt;</span><span class="endtagname tag">/input</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{title:name}</span>!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div></pre><p>In the above snippet, Moya evaluates the expression <code>title:name</code> and replaces the text with the result of that expression. So if you enter the name <code>john</code>, the echo statement will write <code>Hello, John!</code> to the console.</p>
<h2><a name="data-statements"></a><a href="#data-statements">Data Statements<span class="anchor"> &#182;</span></a></h2><p>Moya has a variety of ways to create <em>data</em>, such as numbers and strings, as well as <em>data structures</em>, which are collections of data. Values created in this way may be used in expressions and anywhere Moya expects a value.</p>
<p>Moya has a number of <em>data setter</em> tags which create data. Such tags have two optional attributes; <code>dst</code> which contains the <em>destination</em> name for the value, and <code>value</code> which should an expression. If the <code>value</code> attribute is missing, then the text of the tag is used to create the value.</p>
<p>For example, the following two lines have the same effect; they both assign the value of <code>"Rygel"</code> to a variable called <code>crew</code>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag">&gt;</span>Rygel</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div></pre><p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"'Rygel'"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre></p>
<p>You are free to use whichever form is more convenient, but generally <code>value</code> is best used when you want to set the value to the result of some calculation, and the tag text is best used for constants. An exception would be if you want to use expression substitution in the text, which can be convenient for constructing messages for the user. For example, here is a string definition that would be more verbose as an expression:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"manifest"</span><span class="tag">&gt;</span>There&nbsp;are&nbsp;</span><span class="sub">$</span><span class="braced sub">{len:count}</span>&nbsp;members&nbsp;in&nbsp;the&nbsp;crew.&nbsp;Their&nbsp;names&nbsp;are&nbsp;</span><span class="sub">$</span><span class="braced sub">{commaspacelist:crew}</span>.</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div></pre><p>If you don't include either <code>value</code>, or any tag text, then the value will be set to the default. In the case of strings, this will be an empty strings, for numbers it will be <code>0</code>. The following creates an empty string:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"empty"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h2><a name="simple-data-types"></a><a href="#simple-data-types">Simple data Types<span class="anchor"> &#182;</span></a></h2><p>A <em>simple</em> data type is one that does not contain other values. The following lists Moya's simple data types:</p>
<h3><a name="strings"></a><a href="#strings">Strings<span class="anchor"> &#182;</span></a></h3><p>A string is a sequence of characters, commonly used to store text.</p>
<p>Defining strings is done with the <a class="tag" href="tags/httpmoyaprojectcom/tag_str.html">&lt;str&gt;</a> tag. Here's some examples of creating strings:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"example1"</span><span class="tag">&gt;</span>in&nbsp;order&nbsp;to&nbsp;create&nbsp;an&nbsp;apple&nbsp;pie&nbsp;from&nbsp;scratch,&nbsp;you&nbsp;must&nbsp;first&nbsp;create&nbsp;the&nbsp;universe.</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"example2"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"'Hello&nbsp;'&nbsp;+&nbsp;title:title&nbsp;+&nbsp;'!'"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"example3"</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;Mult-</div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;line</div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;string</div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div></pre><h3><a name="integers"></a><a href="#integers">Integers<span class="anchor"> &#182;</span></a></h3><p>An <em>integer</em> is a whole number. It may be positive or negative, but may not contain a decimal point. Here are some examples of creating integers:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"zero"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span>&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;sets&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;--&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"one_million"</span><span class="tag">&gt;</span>1000000</span><span class="tag">&lt;</span><span class="endtagname tag">/int</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"seconds_in_a_minute"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"60&nbsp;*&nbsp;60"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h3><a name="floats"></a><a href="#floats">Floats<span class="anchor"> &#182;</span></a></h3><p>A <em>floating point</em> number is a number with a decimal point. Here are some examples of creating floats:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">float</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"zero"</span><span class="tag">&gt;</span>&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;sets&nbsp;a&nbsp;value&nbsp;of&nbsp;0.0&nbsp;--&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">float</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"pi_approximation"</span><span class="tag">&gt;</span>3.1427</span><span class="tag">&lt;</span><span class="endtagname tag">/float</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="tag tagname">float</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"one_third"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"1/3"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h3><a name="booleans"></a><a href="#booleans">Booleans<span class="anchor"> &#182;</span></a></h3><p>You can create a <em>boolean</em> (a value which indicates True or False) with the <a class="tag" href="tags/httpmoyaprojectcom/tag_bool.html">&lt;bool&gt;</a> tag which assigned a value of True if the tag text is <code>True</code> or <code>yes</code>, otherwise False. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">bool</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"alive"</span><span class="tag">&gt;</span>yes</span><span class="tag">&lt;</span><span class="endtagname tag">/bool</span><span class="tag">&gt;</span></div></pre><p>There are also shortcuts for boolean values, the <a class="tag" href="tags/httpmoyaprojectcom/tag_true.html">&lt;true&gt;</a> creates a boolean True, whereas the <a class="tag" href="tags/httpmoyaprojectcom/tag_false.html">&lt;false&gt;</a> tag creates a boolean False. Here's an example of these shortcuts in action:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">true</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"alive"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">false</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"false"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h3><a name="expression-results"></a><a href="#expression-results">Expression results<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_var.html">&lt;var&gt;</a> tags assigns the result of an expression to a variable. If tag text is given, it is evaluated as an expression. If it is not given, then the <code>value</code> attribute should contain an expression. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">float</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"pi"</span><span class="tag">&gt;</span>3.1427</span><span class="tag">&lt;</span><span class="endtagname tag">/float</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">floar</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"radius"</span><span class="tag">&gt;</span>12</span><span class="tag">&lt;</span><span class="endtagname tag">/float</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="tag tagname">var</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"circumpherence"</span><span class="tag">&gt;</span>2&nbsp;*&nbsp;pi&nbsp;*&nbsp;radius</span><span class="tag">&lt;</span><span class="endtagname tag">/var</span><span class="tag">&gt;</span></div></pre><h2><a name="compound-data-types"></a><a href="#compound-data-types">Compound Data Types<span class="anchor"> &#182;</span></a></h2><p>A compound data type (also referred to as a <em>collection</em>) contains other data types &ndash; which could be strings and floats, but also other collections. Such collections may be deeply nested, i.e. may contain collections that contain collections etc.</p>
<p>Collections tags are typically assembled from other enclosed data setters, i.e. any data defined inside the collection tag is added to the collection. The following code creates a list (explained below) of three strings:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Rygel</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>John&nbsp;Crichton</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Aeryn&nbsp;Sun</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/list</span><span class="tag">&gt;</span></div></pre><p>You can refer to an <em>element</em> (single value) of a collection with a data index. For example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{crew.1}</span>&nbsp;is&nbsp;human</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div></pre><p>Collections may also be <em>iterated</em> over with the <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a> tag (or anything else that expects a sequence). Here is an example of using <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a> to iterate over <code>crew</code>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{crew}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><h3><a name="lists"></a><a href="#lists">Lists<span class="anchor"> &#182;</span></a></h3><p>A <em>list</em> is a sequence of other values. To create a list use the <a class="tag" href="tags/httpmoyaprojectcom/tag_list.html">&lt;list&gt;</a> tag. Here is an example of list creation:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"complex"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>apples</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag">&gt;</span>1</span><span class="tag">&lt;</span><span class="endtagname tag">/int</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag">&gt;</span>100</span><span class="tag">&lt;</span><span class="endtagname tag">/int</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="endtagname tag">/list</span><span class="tag">&gt;</span></div></pre><p>You can create an empty list just by closing the tag:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"empty"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span>&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;empty&nbsp;list&nbsp;--&gt;</span></div></pre><p>You can also create a <a href="expressions.html#lists" title="Expressions">list</a> in an expression. For example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;crew=</span><span class="attrib tag tagcontent">"['Rygel',&nbsp;'John&nbsp;Crichton',&nbsp;'Aeryn&nbsp;Sun']"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h4><a name="iterating-over-a-list"></a><a href="#iterating-over-a-list">Iterating Over a List<span class="anchor"> &#182;</span></a></h4><p>You can iterate over a list with the <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a> which extracts a value at a time. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><h4><a name="appending-items-to-a-list"></a><a href="#appending-items-to-a-list">Appending Items to a List<span class="anchor"> &#182;</span></a></h4><p>You can add an item to the end of a list with the <a class="tag" href="tags/httpmoyaprojectcom/tag_append.html">&lt;append&gt;</a> tag. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;prime=</span><span class="attrib tag tagcontent">"[1,3,5]"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">append</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"prime"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"7"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h4><a name="removing-items-from-a-list"></a><a href="#removing-items-from-a-list">Removing Items From a list<span class="anchor"> &#182;</span></a></h4><p>You can remove an item from a list with the <a class="tag" href="tags/httpmoyaprojectcom/tag_remove.html">&lt;remove&gt;</a> tag.</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;crew=</span><span class="attrib tag tagcontent">"['Rygel',&nbsp;'John&nbsp;Crichton',&nbsp;'Aeryn&nbsp;Sun']"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">remove</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"'Rygel'"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h3><a name="dictionary"></a><a href="#dictionary">Dictionary<span class="anchor"> &#182;</span></a></h3><p>A <em>dictionary</em> stores values with an associated <em>key</em>. Here's how you can create a dictionary:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">dict</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"rygel"</span><span class="tag">&gt;</span>Hynerian</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"john"</span><span class="tag">&gt;</span>Human</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"aeryn"</span><span class="tag">&gt;</span>Peacekeeper</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/dict</span><span class="tag">&gt;</span></div></pre><p>The <code>dst</code> attribute of the data setters are used as the keys in the dictionary. You can retrieve a value in a dictionary by using its key in a data index. Here's an example of how you might look up a species, given a name (<code>rygel</code> in this case):</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Rygel&nbsp;is&nbsp;a&nbsp;</span><span class="sub">$</span><span class="braced sub">{crew.rygel}</span>.</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div></pre><p>Iterating over a dictionary, returns its keys. For example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{title:crew}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><p>You can iterate over the values or items (pairs of key plus value) by using the <code>values:</code> or <code>items:</code> modifiers (see next chapter for the details). Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"items:crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character,species"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{title:crew}</span>&nbsp;is&nbsp;a&nbsp;</span><span class="sub">$</span><span class="braced sub">{title:species}</span>.</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><p>You may also create a <a href="expressions.html#dictionaries" title="Expressions">dictionary</a> in an expression. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;crew=</span><span class="attrib tag tagcontent">"rygel='Hynerian',&nbsp;john='Human',&nbsp;aeryn='Peacekeeper'"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><h3><a name="json"></a><a href="#json">JSON<span class="anchor"> &#182;</span></a></h3><p>JSON is <em>Javascript Object Notation</em>, which is a subset of the Javascript language, used for storing data in text form. It is versatile enough that many languages include support for it.</p>
<p>In Moya, the <a class="tag" href="tags/httpmoyaprojectcom/tag_json.html">&lt;json&gt;</a> tag can parse data in JSON format. Here's an example of using JSON in Moya code:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">json</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"ships"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="braced">{</span></div><a name="line3"></a><div class="line line-3"><span class="braced">&nbsp;&nbsp;&nbsp;&nbsp;"moya":&nbsp;{</span></div><a name="line4"></a><div class="line line-4"><span class="braced">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"crew":&nbsp;["Rygel",&nbsp;"Aeryn",&nbsp;"john"]</span></div><a name="line5"></a><div class="line line-5"><span class="braced">&nbsp;&nbsp;&nbsp;&nbsp;}</span></div><a name="line6"></a><div class="line line-6">}</div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="endtagname tag">/json</span><span class="tag">&gt;</span></div></pre><p>JSON is a good way of storing structure data, and is generally more efficient that the equivalent nested tags.</p>
<h3><a name="let-statement"></a><a href="#let-statement">LET Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_let.html">&lt;let&gt;</a> tag is a versatile way of assigning the result of expressions to a variable. Simply set an attribute to an expression.</p>
<p>Lets look at an example of assigning a single value:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"name"</span><span class="tag">&gt;</span>John</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;greeting=</span><span class="attrib tag tagcontent">"'Hello,&nbsp;'&nbsp;+&nbsp;name"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>Here, the variable <code>greeting</code> is assigned the value of expression <code>'Hello, ' + name</code>.</p>
<p>Multiple variables may be set with <a class="tag" href="tags/httpmoyaprojectcom/tag_let.html">&lt;let&gt;</a>. The only restriction (a requirement of XML) is that a variable appear only once in a tag. Here's an example of assigning multiple variables:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;x=</span><span class="attrib tag tagcontent">"10"</span><span class="tag tagcontent">&nbsp;y=</span><span class="attrib tag tagcontent">"x*x"</span><span class="tag tagcontent">&nbsp;z=</span><span class="attrib tag tagcontent">"x+y"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>Variables are assigned in the order that they appear in the tag. You'll notice that in the above example, the expressions for <code>y</code> and <code>z</code> depend on the expression preceding it.</p>
<h2><a name="let-extension"></a><a href="#let-extension">LET Extension<span class="anchor"> &#182;</span></a></h2><p>Moya provides an additional way to set data on some compound data statements, and a variety of other tags, via the <em>Let extension</em>. To enable this extension, all you need to do is add the <code>http://moyaproject.com/let</code> namespace to your xml. The root level tag, <a class="tag" href="tags/httpmoyaprojectcom/tag_moya.html">&lt;moya&gt;</a> is the best place for this.</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag tagcontent"></span></div><a name="line2"></a><div class="line line-2"><span class="tag tagcontent">&nbsp;&nbsp;&nbsp;&nbsp;xmlns:let=</span><span class="attrib tag tagcontent">"http://moyaproject.com/let"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;Let&nbsp;extension&nbsp;now&nbsp;available&nbsp;--&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>Once the namespace has been added, you can now assign the result of an expression to a value in a tag. Here's an example of using the let extension to create the values in a dictionary:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">dict</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;let:rygel=</span><span class="attrib tag tagcontent">"'Hynerian'"</span><span class="tag tagcontent">&nbsp;let:john=</span><span class="attrib tag tagcontent">"'human'"</span><span class="tag tagcontent">&nbsp;let:aeryn=</span><span class="attrib tag tagcontent">"'peacekeeper'"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>The above code is equivalent to the following:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">dict</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"rygel"</span><span class="tag">&gt;</span>Hynerian</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"john"</span><span class="tag">&gt;</span>Human</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"aeryn"</span><span class="tag">&gt;</span>Peacekeeper</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/dict</span><span class="tag">&gt;</span></div></pre><p>The let extension can be used in a number of other (non data) tags, where additional data is required. Notably the <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a> which uses let attributes to create parameters. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag tagcontent">&nbsp;xmlns:let=</span><span class="attrib tag tagcontent">"http://moyaproject.com/let"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag tagcontent">&nbsp;let:name=</span><span class="attrib tag tagcontent">"'World'"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><h2><a name="conditional-statements"></a><a href="#conditional-statements">Conditional Statements<span class="anchor"> &#182;</span></a></h2><p>Every statement in Moya may be run conditionally via the optional <code>if</code> attribute, which takes an expression. If the expression is false then the statement will <em>not</em> be executed.</p>
<p>Here's a few examples of the <code>if</code> attribute in action:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">forbidden</span><span class="tag tagcontent">&nbsp;if=</span><span class="attrib tag tagcontent">"not&nbsp;permission:'admin'"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">exit</span><span class="tag tagcontent">&nbsp;if=</span><span class="attrib tag tagcontent">"not&nbsp;user"</span><span class="tag">&gt;</span>Not&nbsp;found</span><span class="tag">&lt;</span><span class="endtagname tag">/exit</span><span class="tag">&gt;</span></div></pre>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">fail</span><span class="tag tagcontent">&nbsp;if=</span><span class="attrib tag tagcontent">"len:value&nbsp;lt&nbsp;3"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;Username&nbsp;should&nbsp;be&nbsp;at&nbsp;least&nbsp;3&nbsp;characters</div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/fail</span><span class="tag">&gt;</span></div></pre></p>
<h2><a name="compound-statements"></a><a href="#compound-statements">Compound Statements<span class="anchor"> &#182;</span></a></h2><p>Some statements (known as <em>compound</em> statements) may contain <em>blocks</em> in the form of further statements enclosed within the opening and closing tag. Such blocks may be executed conditionally, or repeatedly. This is the main mechanism which Moya uses to implement constructs found in most programming languages, such as conditions and loops.</p>
<p>Let's take a look at one such construct, the <a class="tag" href="tags/httpmoyaprojectcom/tag_repeat.html">&lt;repeat&gt;</a> tag, which executes the enclosed block a specific number of times. For example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">repeat</span><span class="tag tagcontent">&nbsp;times=</span><span class="attrib tag tagcontent">"10"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;World!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/repeat</span><span class="tag">&gt;</span></div></pre><p>If you run the above code, it will print the hello world text a total of 10 times.</p>
<h3><a name="if-statment"></a><a href="#if-statment">IF Statment<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> tag runs a block if a condition is true. It works much like the <code>if</code> attribute, but may apply to more than one line. <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> takes a single parameter, <code>test</code>, which should be the expression to evaluate. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"coffee"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Drink&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Mmm,&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div></pre><h3><a name="else-statement"></a><a href="#else-statement">ELSE Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_else.html">&lt;else&gt;</a> tag compliments <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> by running it's code block if a previous <code>if</code> evaluated its condition to false. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"coffee"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Drink&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="tag tagname">else</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Buy&nbsp;more&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/else</span><span class="tag">&gt;</span></div></pre><h3><a name="elif-statement"></a><a href="#elif-statement">ELIF Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_elif.html">&lt;elif&gt;</a> tag is much like <a class="tag" href="tags/httpmoyaprojectcom/tag_else.html">&lt;else&gt;</a>, but accepts another condition. You may use any number of chained <a class="tag" href="tags/httpmoyaprojectcom/tag_elif.html">&lt;elif&gt;</a> tags, which may finish with a final <a class="tag" href="tags/httpmoyaprojectcom/tag_else.html">&lt;else&gt;</a>. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"coffee"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Drink&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="tag tagname">elif</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"tea"</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Drink&nbsp;tea</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/elif</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="tag tagname">else</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Buy&nbsp;more&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line9"></a><div class="line line-9"></span><span class="tag">&lt;</span><span class="endtagname tag">/else</span><span class="tag">&gt;</span></div></pre><h3><a name="repeat-statement"></a><a href="#repeat-statement">REPEAT Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_repeat.html">&lt;repeat&gt;</a> tag executes a block a given number of times, specified by the <code>times</code> attribute (an expression). Here's an example of <a class="tag" href="tags/httpmoyaprojectcom/tag_repeat.html">&lt;repeat&gt;</a>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">repeat</span><span class="tag tagcontent">&nbsp;times=</span><span class="attrib tag tagcontent">"3"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Knock</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/repeat</span><span class="tag">&gt;</span></div></pre><p>This will display <code>"Knock"</code> 3 times.</p>
<p>If you omit the <code>times</code> attribute then the enclosed block will execute indefinitely. It is generally not useful to do this, as your code will never exit, so is best used in conjunction with <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a>.</p>
<h3><a name="while-statement"></a><a href="#while-statement">WHILE Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_while.html">&lt;while&gt;</a> statement repeatedly executes a block while a condition is true. Once the condition because false, the enclosed block is skipped and Moya executes the code after the <a class="tag" href="tags/httpmoyaprojectcom/tag_while.html">&lt;while&gt;</a>. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">int</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"coffee"</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"10"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">while</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"coffee"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Drink&nbsp;coffee</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">dec</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"coffee"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span>&nbsp;</span><span class="comment">&lt;!--&nbsp;subtract&nbsp;1&nbsp;from&nbsp;variable&nbsp;coffee&nbsp;--&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/while</span><span class="tag">&gt;</span></div></pre><p>The above code will display <code>"Drink coffee"</code> 10 times. On each pass through the loop, the variable <code>coffee</code> is reduced by 1. After 10 times, it reaches the value of 0, which evaluates to false, and Moya exits the <a class="tag" href="tags/httpmoyaprojectcom/tag_while.html">&lt;while&gt;</a> loop.</p>
<div class="alert alert-warning">Be careful with the <a class="tag" href="tags/httpmoyaprojectcom/tag_while.html">&lt;while&gt;</a> statement. If your condition never becomes false, Moya will repeatedly execute the block and never exit. If you ever get stuck in one of these <em>infinite loops</em>, you can press Ctrl+C to stop Moya in its tracks.</div><h3><a name="for-statement"></a><a href="#for-statement">FOR Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a> tag executes its block for each item in a sequence. The <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> tag takes two parameters; <code>src</code> (an expression) is the sequence you want to <em>iterate</em> over, and <code>dst</code>. which is the name of the value that will hold the item each time the block is execute.</p>
<p>Here's an example that iterates through a list of strings:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">list</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Ka&nbsp;D'Argo</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Aeryn&nbsp;Sun</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Rygel</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>John&nbsp;Chrichton</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/list</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line9"></a><div class="line line-9"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><p>An optional parameter, <code>filter</code>, may contain an expression that will skip an iteration if it evaluates to false. Here's an example of <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> with the <code>filter</code> attribute:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag tagcontent">&nbsp;filter=</span><span class="attrib tag tagcontent">"character&nbsp;!=&nbsp;'Rygel'"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><p>The above code is equivalent to the following:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"character&nbsp;!=&nbsp;'Rygel"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><h3><a name="break-statement"></a><a href="#break-statement">BREAK Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a> tag exits a loop (<a class="tag" href="tags/httpmoyaprojectcom/tag_while.html">&lt;while&gt;</a>, <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a>, <a class="tag" href="tags/httpmoyaprojectcom/tag_repeat.html">&lt;repeat&gt;</a> etc.) prematurely. Here's an example of using <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a> inside an <a class="tag" href="tags/httpmoyaprojectcom/tag_if.html">&lt;if&gt;</a> tag:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"character=='Rygel'"</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">break</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><p>The above code will execute the block inside <a class="tag" href="tags/httpmoyaprojectcom/tag_for.html">&lt;for&gt;</a> until a condition becomes true. When the <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a> tag executes, it ignores any code still inside the loop and jumps to the point immediately after the loop.</p>
<aside>The listing above could be written more concisely by using the <code>if</code> attribute of the <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a> tag.</aside><h3><a name="continue-statement"></a><a href="#continue-statement">CONTINUE Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_continue.html">&lt;continue&gt;</a> tag compliments <a class="tag" href="tags/httpmoyaprojectcom/tag_break.html">&lt;break&gt;</a> in that it works with loops, but rather than leave the loop entirely, it move directly to the next iteration (i.e. skips the rest of the block).</p>
<p>Here's an example of <a class="tag" href="tags/httpmoyaprojectcom/tag_continue.html">&lt;continue&gt;</a> in action:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">for</span><span class="tag tagcontent">&nbsp;src=</span><span class="attrib tag tagcontent">"crew"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"character"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">if</span><span class="tag tagcontent">&nbsp;test=</span><span class="attrib tag tagcontent">"character=='Rygel'"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">continue</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/if</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{character}</span>&nbsp;is&nbsp;on&nbsp;board!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/for</span><span class="tag">&gt;</span></div></pre><h2><a name="macros"></a><a href="#macros">Macros<span class="anchor"> &#182;</span></a></h2><p>A macro is a block of code that may be <em>called</em> from elsewhere in your code. When the code in the macro has been executed, Moya will return to the original point it was called from. We've seen macros in use when calling Moya code from the command line, but you can also call other macros in the process.</p>
<aside>The term 'macro' is used in Moya for historical reasons, other language would call these 'functions'.</aside><p>Let's define a simple <a class="tag" href="tags/httpmoyaprojectcom/tag_macro.html">&lt;macro&gt;</a>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>We can call this macro with the <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a> tag, which takes a <code>macro</code> attribute containing the name of the macro. Here's how we might call the above macro:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"name"</span><span class="tag">&gt;</span>John&nbsp;Crichton</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/call</span><span class="tag">&gt;</span></div></pre><p>This call could also use the <code>let</code> extension to be a little more concise. The following will have the same effect:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag tagcontent">&nbsp;let:name=</span><span class="attrib tag tagcontent">"John&nbsp;Crichton"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>Whatever method you use, Moya jumps from the <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a> tag to the body of the <code>macro</code>, passing in an <em>argument</em> called <code>name</code>. Arguments used in a call, and any data defined inside the <code>macro</code> are <em>local</em> variables &ndash; they won't exist when the call returns.</p>
<p>You can use macros to <em>return</em> data, with the <a class="tag" href="tags/httpmoyaprojectcom/tag_return.html">&lt;return&gt;</a> tag. Let's modify the <code>greet</code> macro to return a greeting, rather than echo it to the console:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">return</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/return</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>If we call the code above, nothing will be printed to the console. Instead, the function returns a string, which may be stored by the caller if it sets the <code>dst</code> attribute on the <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a>. Let's see that in action:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"greeting"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"name"</span><span class="tag">&gt;</span>Will</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/call</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Macro&nbsp;returned:&nbsp;</span><span class="sub">$</span><span class="braced sub">{greeting}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>In the above code, the call has <code>dst</code> set to <code>"greeting"</code>, which is where the result of the macro call will be stored. It is <a class="tag" href="tags/httpmoyaprojectcom/tag_echo.html">&lt;echo&gt;</a> in the main macro, prints that to the console.</p>
<p>An alternative way of returning a value is to use the <code>value</code> attribute of <a class="tag" href="tags/httpmoyaprojectcom/tag_return.html">&lt;return&gt;</a>. Here's how we might use this to return the text in the <code>greet</code> macro:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"greeting"</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">return</span><span class="tag tagcontent">&nbsp;value=</span><span class="attrib tag tagcontent">"greeting"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><h3><a name="macro-arguments"></a><a href="#macro-arguments">Macro Arguments<span class="anchor"> &#182;</span></a></h3><p>By default, you may call a macro with any <em>arguments</em>. It is also possible to specify exactly what arguments the macro requires with a <a class="tag" href="tags/httpmoyaprojectcom/tag_signature.html">&lt;signature&gt;</a> tag. The advantage of specifying the arguments for a macro is that Moya is able to detect any mistakes in the type or number of parameters.</p>
<p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_signature.html">&lt;signature&gt;</a> should contain a list of <a class="tag" href="tags/httpmoyaprojectcom/tag_argument.html">&lt;argument&gt;</a> tags. Here's how we would modify the <code>greet</code> example to specify the single argument it requires:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">signature</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">argument</span><span class="tag tagcontent">&nbsp;name=</span><span class="attrib tag tagcontent">"name"</span><span class="tag tagcontent">&nbsp;required=</span><span class="attrib tag tagcontent">"yes"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/signature</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">return</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/return</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>The addition of the <a class="tag" href="tags/httpmoyaprojectcom/tag_signature.html">&lt;signature&gt;</a> tells Moya that the macro accepts one required argument, called <em>name</em>. If you don't call it with a value for name, Moya will raise an <a href="moyacode.html#exceptions" title="Moya Code">exception</a>.</p>
<p> <a class="tag" href="tags/httpmoyaprojectcom/tag_argument.html">&lt;argument&gt;</a> tags have an optional <code>check</code> parameter, which should be an expression. If given, and the expression is <em>false</em>, Moya will raise an <a href="moyacode.html#exceptions" title="Moya Code">exception</a>. This is used for detecting errors that may otherwise go unnoticed. The following version of <code>greet</code> checks that the value of <code>name</code> has at least one character:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">signature</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">argument</span><span class="tag tagcontent">&nbsp;name=</span><span class="attrib tag tagcontent">"name"</span><span class="tag tagcontent">&nbsp;required=</span><span class="attrib tag tagcontent">"yes"</span><span class="tag tagcontent">&nbsp;check=</span><span class="attrib tag tagcontent">"len:name&nbsp;gt&nbsp;1"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/signature</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">return</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/return</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><h3><a name="lazy-calls"></a><a href="#lazy-calls">Lazy Calls<span class="anchor"> &#182;</span></a></h3><p>Moya can call macros <em>lazily</em>, which means that the call returns immediately, but the code is only executed when the return value is used. This is occasionally a very useful thing to do. For instance, the Moya authentication library uses this feature to get the current user. If your code never references the 'user', then Moya can avoid doing a database query.</p>
<p>Let's start with the following code to demonstrate lazy calls:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"slow"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Entered&nbsp;in&nbsp;to&nbsp;slow&nbsp;macro</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">sleep</span><span class="tag tagcontent">&nbsp;for=</span><span class="attrib tag tagcontent">"5s"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span>&nbsp;&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;do&nbsp;nothing&nbsp;for&nbsp;5&nbsp;seconds&nbsp;--&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Leaving&nbsp;slow&nbsp;macro</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">return</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">str</span><span class="tag">&gt;</span>done</span><span class="tag">&lt;</span><span class="endtagname tag">/str</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/return</span><span class="tag">&gt;</span></div><a name="line9"></a><div class="line line-9">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line10"></a><div class="line line-10">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line11"></a><div class="line line-11">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"slow"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"result"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line12"></a><div class="line line-12">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line13"></a><div class="line line-13"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>Save the above code as <code>lazy.xml</code> and call it with the following:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">$&nbsp;moya&nbsp;run&nbsp;lazy.xml&nbsp;--breakpoint</div></pre><p>If you then step through the code (hit <code>s</code>), you should see Moya jump from the <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a> to the other macro and execute it. Nothing out of the ordinary. But lets look at what happens if the call is done lazily. Replace the call with the following:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"slow"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"result"</span><span class="tag tagcontent">&nbsp;lazy=</span><span class="attrib tag tagcontent">"yes"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>Now when you run <code>lazy.xml</code>, nothing appears to happen. This is because we haven't attempted to use the return value. Insert the following line after the <code>call</code>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span><span class="sub">$</span><span class="braced sub">{result}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div></pre><p>Now if you run <code>lazy.xml</code>, you should find that as soon as you try to use the value of <code>result</code>, the macro is actually called. The macro will be called if you do anything with <code>result</code>, such as using it in an expression or looking up an attribute.</p>
<aside>Lazy calls are only executed once for each return value, i.e. if you use <code>result</code> a second time, it won't call the macro again.</aside><h2><a name="element-references"></a><a href="#element-references">Element References<span class="anchor"> &#182;</span></a></h2><p>The preceding section on <a href="moyacode#macros">Macros</a> introduced the <code>docname</code> attribute. All elements (instances of a tag) in Moya have an associated <em>docname</em> set with the <code>docname</code> attribute. An element's docname should be unique to the XML file it is defined in (it's an error to use the same docname for more than one tag). The purpose of a docname is to reference another element; we've seen it used when calling a macro. Moya knows which <a class="tag" href="tags/httpmoyaprojectcom/tag_macro.html">&lt;macro&gt;</a> to call by matching the value of <code>macro</code> to an element with that docname.</p>
<aside>If you don't set a docname for an element, Moya will generate one automatically and use it internally</aside><p>There is a second type of name common to all elements, called a <em>libname</em>. A libname is similar to a docname, but must be unique to the <em>library</em> and is used to reference an element that may be in an different XML file within the library. When you use a libname to reference an element, it should be preceded with a <code>#</code>, otherwise Moya would interpret it as a docname. Here's an example of using a libname to call a macro:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;libname=</span><span class="attrib tag tagcontent">"greet"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Hello,&nbsp;</span><span class="sub">$</span><span class="braced sub">{name}</span>!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"#greet"</span><span class="tag tagcontent">&nbsp;name=</span><span class="attrib tag tagcontent">"World"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>In the above example, <a class="tag" href="tags/httpmoyaprojectcom/tag_call.html">&lt;call&gt;</a> has a <code>macro</code> attribute of <code>#greet</code> which references the macro with libname <code>greet</code>. Because we're using a libname rather than a docname, the <code>greet</code> macro could be in <em>any</em> XML file contained within the same library.</p>
<p>Occasionally it is also necessary to reference an element in another library entirely. In these cases, you specify the application name before the <code>#</code> symbol, so that the element reference would be <code>&lt;application name&gt;#&lt;libname&gt;</code>. Let's look at an example of using an element reference with an application name. Consider a fictitious macro in a library called <code>moyaproject.sushifinder</code>, and installed as an application called <code>sushi</code>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;libname=</span><span class="attrib tag tagcontent">"order"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Ordering&nbsp;product&nbsp;</span><span class="sub">$</span><span class="braced sub">{product}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div></pre><p>If we wanted to call the above macro from another application, we could do so with the following code:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"sushi#order"</span><span class="tag tagcontent">&nbsp;let:product=</span><span class="attrib tag tagcontent">"nigiri"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>It is also possible to use the library name in place of the application name. This works as long as the library is installed exactly once. Here's how we would use the library name to call the <code>order</code> macro:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">call</span><span class="tag tagcontent">&nbsp;macro=</span><span class="attrib tag tagcontent">"moya.sushifinder#order"</span><span class="tag tagcontent">&nbsp;product=</span><span class="attrib tag tagcontent">"nigiri"</span><span class="tag tagcontent">&nbsp;</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>Generally speaking it is preferable to use libnames over docnames, so that you aren't tied to a single XML file.</p>
<h2><a name="exceptions"></a><a href="#exceptions">Exceptions<span class="anchor"> &#182;</span></a></h2><p>In some situations, Moya is unable to do what is asked of it, or a condition occurs that makes it unable to continue normally. In these cases Moya uses <em>exceptions</em> to report the problem, which allows you to write code that can recover from such conditions.</p>
<p>Let's see what happens when an exception occurs. The following code attempts to divide by zero, which Moya (and most languages) can't do:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">moya</span><span class="tag tagcontent">&nbsp;xmlns=</span><span class="attrib tag tagcontent">"http://moyaproject.com"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">macro</span><span class="tag tagcontent">&nbsp;docname=</span><span class="attrib tag tagcontent">"main"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;infinity=</span><span class="attrib tag tagcontent">"1/0"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="endtagname tag">/macro</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/moya</span><span class="tag">&gt;</span></div></pre><p>if you run the above code from the command line, you will see a message in the console, that looks something like this:</p>
<pre class="moya-console format-"><a name="line1"></a><div class="line line-1">math.division-error:&nbsp;Can't&nbsp;divide&nbsp;by&nbsp;zero&nbsp;in&nbsp;'1/0'</div></pre><p>In this message, <code>math.division-error</code> is the exception name, the text that follows is a description of the problem. The reason that the message appears in the console is that the exception was <em>unhandled</em>, meaning there was nothing in the code to detect and respond to that exception. Moya stopped running code at the point the error occurred and generated the error message.</p>
<p>If this occurred when running a web application, the user will see a 500 (error) page, or an error report if in debug mode. If we don't want this to happen, we must first <em>catch</em> the exception.</p>
<h3><a name="catching-exceptions"></a><a href="#catching-exceptions">Catching Exceptions<span class="anchor"> &#182;</span></a></h3><p>We can catch an exception from the previous statement with the <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> tag. Here's how we might catch the <code>"math.divisionerror"</code> exception:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;infinity=</span><span class="attrib tag tagcontent">"1/0"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Can't&nbsp;divide&nbsp;by&nbsp;zero!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre><p>Here the code doesn't exit when we divide by zero. The code inside the <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> statement is executed, and we get a message telling us we can't divide by zero.</p>
<p>A <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> without any attributes will catch <em>all</em> exceptions that could occur. It is rarely a good idea to do this, because it might mask unrelated errors. We can catch a specific error with the <code>exception</code> attribute. Let's modify the previous sample to only catch <code>"math.division-error"</code>:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;infinity=</span><span class="attrib tag tagcontent">"1/0"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"math.division-error"</span><span class="tag">&gt;</span>&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;catch&nbsp;the&nbsp;one&nbsp;exception&nbsp;--&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Can't&nbsp;divide&nbsp;by&nbsp;zero!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre><p>It is possible to catch a range of errors with a single <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> by using an exception <em>wildcard</em>. For example, <code>math.*</code> will match all mathematical exceptions. Other exceptions are organized in to hierarchies so you can catch specific classes of exception.</p>
<aside>An exception wildcard of <code>"*"</code> is equivalent to a <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> without an <code>exception</code> attribute.</aside><h3><a name="naming-exceptions"></a><a href="#naming-exceptions">Naming Exceptions<span class="anchor"> &#182;</span></a></h3><p>Exceptions follow a naming convention. There are a number of exceptions that Moya itself may throw; these contain a single period (<code>math.division-error</code> is one example). Code in a library may also throw exceptions (See user defined exceptions below); these consist of the library <em>long name</em>, further broken down with more periods.</p>
<aside>It is possible to name your exceptions anything you want, but following this convention will ensure that your project can work with other libraries.</aside><p>For example, the Moya User library can throw an exception called <code>moya.auth.password-fail</code> if the password is not correct. This naming convention allows us to catch any exceptions from the moya.auth library. For example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"moya.auth.*"</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Not&nbsp;logged&nbsp;in!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre><p>When you write your own libraries, you should follow this same convention. See below for an explanation of working with your own exceptions.</p>
<h3><a name="try-statement"></a><a href="#try-statement">TRY Statement<span class="anchor"> &#182;</span></a></h3><p>The <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> tag, catches exceptions from the previous statement. Sometimes it is necessary to catch exceptions that may occur in a block of statements. We can do this with <a class="tag" href="tags/httpmoyaprojectcom/tag_try.html">&lt;try&gt;</a> which simply executes a block. Here's how we could catch all <code>math.division-error</code> exceptions in a block of code:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">try</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Attempting&nbsp;to&nbsp;divide&nbsp;by&nbsp;zero...</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">let</span><span class="tag tagcontent">&nbsp;infinity=</span><span class="attrib tag tagcontent">"1/0"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>We&nbsp;will&nbsp;never&nbsp;get&nbsp;here</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="endtagname tag">/try</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"math.division-error"</span><span class="tag">&gt;</span>&nbsp;&nbsp;</span><span class="comment">&lt;!--&nbsp;catch&nbsp;the&nbsp;one&nbsp;exception&nbsp;--&gt;</span></div><a name="line7"></a><div class="line line-7">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Can't&nbsp;divide&nbsp;by&nbsp;zero!</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line8"></a><div class="line line-8"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre><p>The code in a <a class="tag" href="tags/httpmoyaprojectcom/tag_try.html">&lt;try&gt;</a> block is rarely as simple as this. The actual exception may occur in a macro you have called in your <a class="tag" href="tags/httpmoyaprojectcom/tag_try.html">&lt;try&gt;</a> block, or even more deeply nested. As long as the execution started inside the <a class="tag" href="tags/httpmoyaprojectcom/tag_try.html">&lt;try&gt;</a>, you will be able to catch any exceptions.</p>
<h3><a name="throwing-exceptions"></a><a href="#throwing-exceptions">Throwing Exceptions<span class="anchor"> &#182;</span></a></h3><p>Up to this point we have been catching exceptions thrown by Moya itself. It is also possible to throw your own exceptions to handle conditions that may otherwise be difficult to report. Throwing an exception is done with the <a class="tag" href="tags/httpmoyaprojectcom/tag_throw.html">&lt;throw&gt;</a> tag, which takes a single attribute, <code>exception</code>, containing the name of the exception you want to throw.</p>
<p>Here's an example of how to throw an exception:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">try</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">throw</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.error"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Will&nbsp;never&nbsp;get&nbsp;here</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4"></span><span class="tag">&lt;</span><span class="endtagname tag">/try</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.*"</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Sorry,&nbsp;Can't&nbsp;do&nbsp;that&nbsp;with&nbsp;Bob's&nbsp;widgets</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line7"></a><div class="line line-7"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre><p>In the above code, Moya executes the <a class="tag" href="tags/httpmoyaprojectcom/tag_throw.html">&lt;throw&gt;</a> statement, which creates the exception. It is immediately caught by the <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> statement underneath the <a class="tag" href="tags/httpmoyaprojectcom/tag_try.html">&lt;try&gt;</a>. Of course, in real code, exceptions would be thrown if some real-world condition is detected. The name of the exception follows the naming guidelines of beginning with the name of your library, here the library would be the fictitious <code>bobs.widgets</code> library.</p>
<p>When you throw an exception, you can also attach a message with the <code>msg</code> attribute. This text is displayed if the exception is unhandled. Here's how to attach a message to the exception above:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">throw</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.error"</span><span class="tag tagcontent">&nbsp;msg=</span><span class="attrib tag tagcontent">"Out&nbsp;of&nbsp;Stock"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>It is good practice to add a <code>msg</code>; it can help diagnose problems.</p>
<aside>For the above exception, it may be a good idea to name it <code>bobs.widgets.out-of-stock</code>, or similar, so that it may be treated differently from other errors.</aside><h3><a name="exception-information"></a><a href="#exception-information">Exception Information<span class="anchor"> &#182;</span></a></h3><p>Exceptions may have additional data associated with them, presumably containing information that may help the code that catches the exception decide how to respond. You can attach such data to exceptions with the <code>let</code> extension. Here's an example:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">throw</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.error"</span><span class="tag tagcontent">&nbsp;msg=</span><span class="attrib tag tagcontent">"Out&nbsp;of&nbsp;Stock"</span><span class="tag tagcontent">&nbsp;let:item=</span><span class="attrib tag tagcontent">"deluxe"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div></pre><p>The above code associates a string named <code>item</code> with the exception being thrown. The <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a> statement may retrieve this information via its <code>dst</code> attribute. Inside the <a class="tag" href="tags/httpmoyaprojectcom/tag_catch.html">&lt;catch&gt;</a>, the value referenced by <code>dst</code>, will contain an <em>exception object</em>. Exception objects have 3 attributes; <code>msg</code>, <code>type</code> and <code>info</code>. The <code>type</code> attribute contains the exception type (e.g. <code>bobs.widgets.error</code>); <code>msg</code> contains a short description of the exception; and <code>info</code> is a dictionary with the attached information.</p>
<p>Here's how you might respond to data in an exception:</p>
<pre class="moya-console format-xml"><a name="line1"></a><div class="line line-1"></span><span class="tag">&lt;</span><span class="tag tagname">throw</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.error"</span><span class="tag tagcontent">&nbsp;msg=</span><span class="attrib tag tagcontent">"Out&nbsp;of&nbsp;Stock"</span><span class="tag tagcontent">&nbsp;let:item=</span><span class="attrib tag tagcontent">"deluxe"</span><span class="endtagname tag">/</span><span class="tag">&gt;</span></div><a name="line2"></a><div class="line line-2"></span><span class="tag">&lt;</span><span class="tag tagname">catch</span><span class="tag tagcontent">&nbsp;exception=</span><span class="attrib tag tagcontent">"bobs.widgets.*"</span><span class="tag tagcontent">&nbsp;dst=</span><span class="attrib tag tagcontent">"error"</span><span class="tag">&gt;</span></div><a name="line3"></a><div class="line line-3">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Message&nbsp;is:&nbsp;</span><span class="sub">$</span><span class="braced sub">{error.msg}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line4"></a><div class="line line-4">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Exception&nbsp;type&nbsp;is:&nbsp;</span><span class="sub">$</span><span class="braced sub">{error.type}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line5"></a><div class="line line-5">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="tag">&lt;</span><span class="tag tagname">echo</span><span class="tag">&gt;</span>Item&nbsp;is:&nbsp;</span><span class="sub">$</span><span class="braced sub">{error.info.item}</span><span class="tag">&lt;</span><span class="endtagname tag">/echo</span><span class="tag">&gt;</span></div><a name="line6"></a><div class="line line-6"></span><span class="tag">&lt;</span><span class="endtagname tag">/catch</span><span class="tag">&gt;</span></div></pre>
            

<div class="doc-nav">
    <ul class="pager">
        <li class="previous">
            <a href="start.html">&larr; 4. Starting a Project</a>
        </li>
        
        <li class="next">
            <a href="expressions.html">6. Expressions &rarr;</a>
        </li>
    </ul>
</div>


        </div>
        
        <div class="doctree-panel col-md-3">
        <ul>
    
    <li><a href="#testing-moya-code">Testing Moya Code</a><ul>
    
    <li><a href="#using-the-debugger">Using the Debugger</a></li>
    
    <li><a href="#dynamic-help">Dynamic Help</a></li>
    
</ul></li>
    
    <li><a href="#statements">Statements</a></li>
    
    <li><a href="#expressions">Expressions</a><ul>
    
    <li><a href="#numbers">Numbers</a></li>
    
    <li><a href="#strings">Strings</a></li>
    
    <li><a href="#operators">Operators</a></li>
    
    <li><a href="#modifiers">Modifiers</a></li>
    
</ul></li>
    
    <li><a href="#expression-substitution">Expression Substitution</a></li>
    
    <li><a href="#data-statements">Data Statements</a></li>
    
    <li><a href="#simple-data-types">Simple data Types</a><ul>
    
    <li><a href="#strings">Strings</a></li>
    
    <li><a href="#integers">Integers</a></li>
    
    <li><a href="#floats">Floats</a></li>
    
    <li><a href="#booleans">Booleans</a></li>
    
    <li><a href="#expression-results">Expression results</a></li>
    
</ul></li>
    
    <li><a href="#compound-data-types">Compound Data Types</a><ul>
    
    <li><a href="#lists">Lists</a></li>
    
    <li><a href="#dictionary">Dictionary</a></li>
    
    <li><a href="#json">JSON</a></li>
    
    <li><a href="#let-statement">LET Statement</a></li>
    
</ul></li>
    
    <li><a href="#let-extension">LET Extension</a></li>
    
    <li><a href="#conditional-statements">Conditional Statements</a></li>
    
    <li><a href="#compound-statements">Compound Statements</a><ul>
    
    <li><a href="#if-statment">IF Statment</a></li>
    
    <li><a href="#else-statement">ELSE Statement</a></li>
    
    <li><a href="#elif-statement">ELIF Statement</a></li>
    
    <li><a href="#repeat-statement">REPEAT Statement</a></li>
    
    <li><a href="#while-statement">WHILE Statement</a></li>
    
    <li><a href="#for-statement">FOR Statement</a></li>
    
    <li><a href="#break-statement">BREAK Statement</a></li>
    
    <li><a href="#continue-statement">CONTINUE Statement</a></li>
    
</ul></li>
    
    <li><a href="#macros">Macros</a><ul>
    
    <li><a href="#macro-arguments">Macro Arguments</a></li>
    
    <li><a href="#lazy-calls">Lazy Calls</a></li>
    
</ul></li>
    
    <li><a href="#element-references">Element References</a></li>
    
    <li><a href="#exceptions">Exceptions</a><ul>
    
    <li><a href="#catching-exceptions">Catching Exceptions</a></li>
    
    <li><a href="#naming-exceptions">Naming Exceptions</a></li>
    
    <li><a href="#try-statement">TRY Statement</a></li>
    
    <li><a href="#throwing-exceptions">Throwing Exceptions</a></li>
    
    <li><a href="#exception-information">Exception Information</a></li>
    
</ul></li>
    
</ul>
        </div>
        
    </div>
</div>

    <div id="push"></div>

    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">Moya is &copy; 2014 <a href="#">Moya Software Foundation</a>.</p>
      </div>
    </div>

    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.js"></script>


</body>

</html>